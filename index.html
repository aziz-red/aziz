<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø²ÙŠØ² Ù†Øª - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root{--m:#DD2476;--s:#FF512F;--w:#fff;--t:#333;--scan:#8e44ad}
        *{box-sizing:border-box;margin:0;padding:0;font-family:'Tajawal',sans-serif}
        body{background:linear-gradient(135deg,var(--s),var(--m));min-height:100vh;display:flex;justify-content:center;align-items:center;overflow-x:hidden;padding:80px 20px 20px}
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± - Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ */
        .news-ticker-container{position:fixed;top:0;left:0;width:100%;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);box-shadow:0 4px 15px rgba(0,0,0,.1);z-index:9999;height:50px;display:flex;align-items:center;border-bottom:3px solid var(--m)}
        .ticker-label{background:linear-gradient(to left,var(--s),var(--m));color:var(--w);padding:0 20px;height:100%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;white-space:nowrap;box-shadow:-4px 0 10px rgba(0,0,0,.1);z-index:20;gap:10px}
        .ticker-wrapper{flex:1;overflow:hidden;position:relative;height:100%;display:flex;align-items:center;background:#fff}
        .ticker-content{position:absolute;white-space:nowrap;will-change:transform;animation:m 15s linear infinite;color:var(--t);font-weight:700;font-size:.95rem;direction:rtl;width:max-content}
        .ticker-text-fix{display:inline-block;padding:0 20px}
        @keyframes m{0%{transform:translateX(-20%)}100%{transform:translateX(calc(100vw + 75%))}}
        .news-separator{margin:0 25px;color:var(--m);font-size:1.1em}

        /* Ø¨Ù‚ÙŠØ© Ø§Ù„ØªØµÙ…ÙŠÙ… */
        .main-card{background:rgba(255,255,255,.95);width:100%;max-width:420px;border-radius:20px;padding:30px 20px;box-shadow:0 10px 40px rgba(0,0,0,.2);position:relative;text-align:center}
        .view-section{display:none;animation:f .4s ease-in-out}
        .view-section.active{display:block}
        @keyframes f{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        h2,h3{color:var(--t);margin-bottom:15px}
        .wifi-icon{width:90px;height:80px;margin:0 auto 15px;display:flex;justify-content:center;align-items:center}
        .wifi-icon svg{width:100%;height:100%}
        .subtitle{color:#666;font-size:.9rem;margin-bottom:25px}
        .input-group{position:relative;margin-bottom:15px}
        .input-field{width:100%;padding:10px 40px 10px 10px;border:2px solid #eee;border-radius:10px;font-size:1rem;outline:0;transition:.3s;background:#f9f9f9}
        .input-field:focus{border-color:var(--m);background:var(--w)}
        .input-icon{position:absolute;right:15px;top:50%;transform:translateY(-50%);width:28px;height:28px;display:flex;align-items:center;justify-content:center;pointer-events:none}
        select{width:100%;padding:12px;border-radius:10px;border:2px solid #eee;margin-bottom:15px;font-family:'Tajawal';background:var(--w);cursor:pointer}
        .btn{width:100%;padding:15px;border:none;border-radius:10px;font-weight:700;cursor:pointer;font-size:1rem;display:flex;justify-content:center;align-items:center;gap:10px;transition:transform .2s;text-decoration:none;color:var(--w);margin-bottom:10px}
        .btn:active{transform:scale(.98)}
        .btn svg{width:28px;height:28px}
        .btn-primary{background:linear-gradient(to right,var(--s),var(--m));box-shadow:0 4px 15px rgba(221,36,118,.3)}
        .btn-wa{background:#25D366;box-shadow:0 4px 15px rgba(37,211,102,.3)}
        .btn-outline{background:0 0;border:2px solid #eee;color:#555}
        .btn-scan{background:var(--scan);box-shadow:0 4px 15px rgba(142,68,173,.3);margin-bottom:15px} 
        
        /* Ø£Ø²Ø±Ø§Ø± Ø¬Ø¯ÙŠØ¯Ø© */
        .btn-gallery{background:#3498db;box-shadow:0 4px 15px rgba(52,152,219,.3);margin-bottom:10px}
        .zoom-tools{display:flex;justify-content:center;gap:10px;margin-bottom:10px}
        .btn-zoom{background:#eee;color:#333;padding:5px 15px;border-radius:5px;font-weight:bold;border:1px solid #ccc}

        .btn-logout{background:#ff4757;color:var(--w);margin-top:20px}
        .secondary-actions{display:flex;gap:10px;margin-top:20px}
        .btn-small{flex:1;padding:10px;font-size:.9rem;border-radius:8px}
        .shake{animation:s .5s;border-color:#ff4757!important;background:#ffe0e3}
        @keyframes s{0%,100%{transform:translateX(0)}25%,75%{transform:translateX(-5px)}50%{transform:translateX(5px)}}
        .error-msg{color:#ff4757;font-size:.85rem;margin-top:-10px;display:none;font-weight:700;align-items:center;gap:5px}
        .list-item{display:flex;justify-content:space-between;padding:8px;background:#f8f9fa;border-radius:6px;margin-bottom:6px;font-size:.9rem;border:1px solid #eee}
        .price-tag{background:var(--t);color:var(--w);padding:2px 8px;border-radius:90px;font-size:.8rem}
        .success-icon{width:80px;height:80px;color:#2ecc71;margin:0 auto 20px;animation:p .6s cubic-bezier(.68,-.55,.265,1.55)}
        @keyframes p{from{transform:scale(0)}to{transform:scale(1)}}
        .spinner-container{margin-top:20px;display:flex;justify-content:center}
        .spinner{width:48px;height:48px;border:6px solid #eee;border-top-color:var(--m);border-radius:50%;animation:sp .8s linear infinite}
        
        /* ØªØ­Ø³ÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        #reader {width: 100% !important; border-radius: 15px; overflow: hidden; margin-bottom: 15px; background: #000; border: 2px solid var(--scan); min-height: 250px;}
        #reader video {object-fit: cover !important;}
        
        @media (max-width:480px){.ticker-label{padding:0 10px;font-size:.8rem}.ticker-content{font-size:.85rem}}
    </style>
</head>
<body>
    <div class="news-ticker-container">
        <div class="ticker-label">
            <svg width="28" height="28" viewBox="0 0 64 64" fill="none" stroke="#ffffff" stroke-width="2.24" stroke-linecap="round" stroke-linejoin="round"><circle cx="29" cy="51" r="2"/><circle cx="16.1" cy="12.5" r="1.1"/><circle cx="39.1" cy="49.5" r="1.1"/><path d="M27.6 6.1h3m-3 0h3M8.6 36.1l3.2 14.2 4.9-1.1-2.6-11.7"/><circle cx="5.1" cy="27.5" r="1.1"/><circle cx="5.1" cy="30.5" r="1.1"/><circle cx="50.5" cy="28.5" r="6.5"/><path d="M53 26l-5 5"/><circle cx="48.5" cy="26.5" r="1.1"/><circle cx="52.5" cy="30.5" r="1.1"/><path d="M45 18h10a3 3 0 003-3v0a3 3 0 00-3-3h-2M51 39h4a3 3 0 013 3v0a3 3 0 01-3 3h-2M42 18h-3M48 39h-9M39 35h4M39 22h5M39 26h2M39 31h2M9 22H5.2A4.2 4.2 0 001 26.2v5.6A4.2 4.2 0 005.2 36H9l26 7V15ZM23 25v8M26 24v10M29 23v12M9 22v14"/></svg>
            ØªÙ†ÙˆÙŠÙ‡ Ù‡Ø§Ù…
        </div>
        <div class="ticker-wrapper">
            <div class="ticker-content">
                <span class="ticker-text-fix">
                    ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø´Ø¨ÙƒØ© Ø¹Ø²ÙŠØ² Ù†Øª ÙŠÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…Ù…ÙŠØ²Ø© Ø¬Ø¯Ø§ ÙˆØ£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§ÙØ³Ø© ÙˆØ³Ø±Ø¹Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§! 
                    <span class="ticker-text-fix">
                    ğŸ‰Ø¹Ø²ÙŠØ² Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø· Ø¨Ø¬Ø§Ø´ ØµØ§Ù„Ø­ Ù‚Ø§Ø³Ù… Ø¹Ù„ÙŠ Ù…Ø§Ù†Ø¹ Ø§Ù„Ø­Ù…ÙŠØ±ÙŠ!
                    <span class="news-separator">|</span> 
                    ğŸš€ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ±ÙØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ø³Ø±Ø¹Ø© Ø®ÙŠØ§Ù„ÙŠØ© 
                    <span class="news-separator">|</span> 
                    ğŸ’¡ Ù„Ù„Ø¥Ø³ØªÙØ³Ø§Ø± Ø£Ùˆ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ 739367154.
                </span>
            </div>
        </div>
    </div>

    <div class="main-card">
        <div id="view-login" class="view-section active">
            <div class="wifi-icon">
                <svg viewBox="0 0 12 12" fill="#ff512f"><path d="M7 8c-1.1 0-2 1-2 2s1 2 2 2 2-1 2-2l0 0C9 8.9 8.1 8 7 8M7 4l0 2c2 0 4.1 2 4.1 4l2 0C13 7 9.9 4 7 4M17 10l-2 0c0-4-4.1-8-8-8l0-2C12 0 17 4 17 10" transform="translate(-5 -0.5) scale(0.9)"/></svg>
            </div>
            <h2>Ø£Ù…Ø³ÙŠØ© Ø³Ø¹ÙŠØ¯Ø©</h2>
            <p class="subtitle">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ ğŸš€</p>
            <form onsubmit="handleLogin(event)">
                <div class="input-group">
                    <input type="tel" id="cardInput" class="input-field" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Øª (Ù…Ø«Ø§Ù„: 7166)" required>
                    <div class="input-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff512f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 19H6.2c-1.1 0-1.7 0-2.1-.2a2 2 0 01-.9-.9C3 17.5 3 16.9 3 15.8V8.2c0-1.1 0-1.7.2-2.1a2 2 0 01.9-.9c.4-.2 1-.2 2.1-.2H17.8c1.1 0 1.7 0 2.1.2a2 2 0 01.9.9c.2.4.2 1 .2 2.1V12M3 9h18M18 21v-6M21 18l-6 0"/></svg>
                    </div>
                </div>
                
                <button type="button" onclick="startScanner()" class="btn btn-scan">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                    Ù…Ø³Ø­ Ø§Ù„ÙƒØ±Øª Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                </button>

                <p id="errorText" class="error-msg">Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Øª Ø®Ø§Ø·Ø¦! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                <select id="speedSelectMain">
                    <option>ğŸš€ Ø³Ø±Ø¹Ø© Ù…ÙØªÙˆØ­Ø© (VIP)</option>
                    <option>ğŸ® Ø³Ø±Ø¹Ø© Ø£Ù„Ø¹Ø§Ø¨ (Gaming)</option>
                    <option>ğŸ’° Ø³Ø±Ø¹Ø© Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</option>
                </select>
                <button type="submit" class="btn btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            </form>
            <div class="secondary-actions">
                <button onclick="switchView('branches')" class="btn btn-outline btn-small">Ø§Ù„ÙØ±ÙˆØ¹ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
                <button onclick="openWhatsApp()" class="btn btn-wa btn-small">ÙˆØ§ØªØ³Ø§Ø¨</button>
            </div>
        </div>
        
        <div id="view-scan" class="view-section">
            <h3>Ù…Ø³Ø­ ÙƒÙˆØ¯ Ø§Ù„ÙƒØ±Øª</h3>
            <div id="reader"></div>
            
            <div class="zoom-tools">
                <button class="btn-zoom" onclick="changeZoom(1)">1x</button>
                <button class="btn-zoom" onclick="changeZoom(2)">2x (ÙÙˆÙƒØ³ Ø£ÙØ¶Ù„)</button>
                <button class="btn-zoom" onclick="changeZoom(3)">3x</button>
            </div>

            <input type="file" id="qr-input-file" accept="image/*" style="display:none">
            <button onclick="document.getElementById('qr-input-file').click()" class="btn btn-gallery">
                ğŸ–¼ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶
            </button>
            
            <button onclick="stopScanner()" class="btn btn-outline">Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>

        <div id="view-branches" class="view-section">
            <h3>Ø§Ù„ÙØ±ÙˆØ¹ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
            <div class="list-item"><span>Ø¨Ø§Ù‚Ø© Ø³Ø§Ø¹Ø©</span> <span class="price-tag">100 Ø±ÙŠØ§Ù„</span></div>
            <div class="list-item"><span>Ø¨Ø§Ù‚Ø© ÙŠÙˆÙ…</span> <span class="price-tag">500 Ø±ÙŠØ§Ù„</span></div>
            <button onclick="switchView('login')" class="btn btn-outline">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <div id="view-success" class="view-section">
            <div class="success-icon">
                <svg viewBox="0 0 512 512" fill="currentColor"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM227.3 387.3l184-184c6.2-6.2 6.2-16.4 0-22.6l-22.6-22.6c-6.2-6.2-16.4-6.2-22.6 0L216 308.1l-70.1-70.1c-6.2-6.2-16.4-6.2-22.6 0l-22.6 22.6c-6.2 6.2-6.2 16.4 0 22.6l104 104c6.2 6.2 16.4 6.2 22.6 0z"/></svg>
            </div>
            <h2>ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!</h2>
            <div class="spinner-container"><div class="spinner"></div></div>
        </div>

        <div id="view-info" class="view-section">
            <div class="user-avatar">
                <svg viewBox="0 0 448 512" fill="currentColor"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128z"/></svg>
            </div>
            <h3 id="welcomeMsg">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ</h3>
            <div class="info-row"><span class="label">Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Øª</span><span class="value" id="displayCardNumber">--</span></div>
            <button onclick="handleLogout()" class="btn btn-logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <script>
        const VALID_CARDS=['7166','0000'], WHATSAPP_NUMBER='967739367154';
        const el=i=>document.getElementById(i);
        let html5QrCode;
        let track; // Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø²ÙˆÙ… ÙˆØ§Ù„ÙÙˆÙƒØ³

        function switchView(id){
            document.querySelectorAll('.view-section').forEach(e=>e.classList.remove('active'));
            el('view-'+id).classList.add('active');
        }
        
        const openWhatsApp=()=>window.open(`https://wa.me/${WHATSAPP_NUMBER}`,'_blank');

        function startScanner() {
            switchView('scan');
            setTimeout(() => {
                if (!html5QrCode) html5QrCode = new Html5Qrcode("reader");
                
                const config = { 
                    fps: 20, 
                    qrbox: { width: 220, height: 220 }, // ØªØµØºÙŠØ± Ø§Ù„Ù…Ø±Ø¨Ø¹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„ÙÙˆÙƒØ³
                    aspectRatio: 1.0,
                    videoConstraints: {
                        facingMode: "environment",
                        focusMode: "continuous" // Ø·Ù„Ø¨ Ø§Ù„ÙÙˆÙƒØ³ Ø§Ù„Ù…Ø³ØªÙ…Ø±
                    }
                };
                
                html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess)
                .then(() => {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø³ØªØ´Ø¹Ø± Ø§Ù„Ø²ÙˆÙ… Ø¨Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                    const video = document.querySelector('#reader video');
                    if (video && video.srcObject) {
                        track = video.srcObject.getVideoTracks()[0];
                    }
                })
                .catch(err => {
                    alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø±Ø¶.");
                    switchView('login');
                });
            }, 300);
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø²ÙˆÙ… Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙÙˆÙƒØ³ ÙŠØ¯ÙˆÙŠØ§Ù‹
        async function changeZoom(level) {
            if (track && track.getCapabilities().zoom) {
                try {
                    await track.applyConstraints({ advanced: [{ zoom: level }] });
                } catch (e) { console.error("Zoom not supported"); }
            } else if (level > 1) {
                alert("Ø§Ù„Ø²ÙˆÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ØŒ Ø­Ø§ÙˆÙ„ ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ÙƒØ±Øª ÙŠØ¯ÙˆÙŠØ§Ù‹.");
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶
        el('qr-input-file').addEventListener('change', e => {
            if (e.target.files.length === 0) return;
            const file = e.target.files[0];
            const reader = new Html5Qrcode("reader");
            reader.scanFile(file, true)
                .then(text => onScanSuccess(text))
                .catch(err => alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙˆØ¯ ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©."));
        });

        function onScanSuccess(decodedText) {
            if (html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop().then(() => {
                    el('cardInput').value = decodedText;
                    switchView('login');
                    handleLogin();
                });
            } else {
                el('cardInput').value = decodedText;
                switchView('login');
                handleLogin();
            }
        }

        function stopScanner(){
            if(html5QrCode && html5QrCode.isScanning){
                html5QrCode.stop().then(() => switchView('login')).catch(() => switchView('login'));
            } else {
                switchView('login');
            }
        }

        function handleLogin(e){
            if(e) e.preventDefault();
            const i=el('cardInput'),err=el('errorText'),v=i.value;
            if(VALID_CARDS.includes(v)){
                err.style.display='none';
                localStorage.setItem('userCard',v);
                switchView('success');
                setTimeout(()=>showInfoPage(v),2000);
            }else{
                err.style.display='flex';
                i.classList.add('shake');
                setTimeout(()=>i.classList.remove('shake'),500);
            }
        }

        function showInfoPage(c){
            el('displayCardNumber').innerText=c;
            el('welcomeMsg').innerText="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "+c;
            switchView('info');
        }

        function handleLogout(){
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')){
                localStorage.removeItem('userCard');
                el('cardInput').value='';
                switchView('login');
            }
        }

        window.onload=()=>{
            const c=localStorage.getItem('userCard');
            if(c) showInfoPage(c);
        };
    </script>
</body>
</html>
